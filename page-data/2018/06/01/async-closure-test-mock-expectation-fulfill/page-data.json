{"componentChunkName":"component---src-templates-post-tsx","path":"/2018/06/01/async-closure-test-mock-expectation-fulfill/","result":{"data":{"markdownRemark":{"html":"<p><em>In this post I will talk about asynchronous testing in Swift.</em></p>\n<hr>\n<p>As we saw in <a href=\"/2017/06/02/swift-closure-syntax/\" title=\"what are closure\">this post</a> and also\nin <a href=\"/2017/06/14/swift-closure-demystifying-autoclosure-escaping/\" title=\"autoclose and escaping\">this other one</a>, closures\nare one of the most important building block of Swift. They are extensively used inside the iOS SDK.<br>\nBut in the previous posts about closures I didn't answer one very important question: how can you do unit test\nasynchronous operation and closure? It seems Apple has the answer for us!! Inside the iOS Testing framework we have **\nexpectations**.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5ce9b04179fd8283b2c1d5efe9c6ec6a/41099/expectation-closure.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMEAf/EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAc19OOLkmT4LzkA//8QAHBABAQACAgMAAAAAAAAAAAAAAgEAAwQSEyEi/9oACAEBAAEFAtaOPuJZJmqaVnL+nT7DUPlVlqz/xAAVEQEBAAAAAAAAAAAAAAAAAAARIP/aAAgBAwEBPwFj/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAHRAAAgEEAwAAAAAAAAAAAAAAAAECESFBkRIxMv/aAAgBAQAGPwLGhNxiZ2cqK4nFt0LI7Gemf//EABwQAAIDAAMBAAAAAAAAAAAAAAABESExQVFhcf/aAAgBAQABPyGN3jdYUiGqUEDVrchI28DwVogTjEIfQpvTlT6aWPUNO2/Wf//aAAwDAQACAAMAAAAQ6y99/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQIVH/2gAIAQMBAT8QaMrJ/8QAFhEBAQEAAAAAAAAAAAAAAAAAAREg/9oACAECAQE/EIjj/8QAHRABAQACAgMBAAAAAAAAAAAAAREAIUFhMVFxof/aAAgBAQABPxA4OSjG1M/Jm6DHZbN/mOgBEAY9ejrE0I8EjhnvH3CpptPHeMivENv1x0iIQHQw0wxIqJr7hBchumf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Yes, you can test asynchronous code!\"\n        title=\"Yes, you can test asynchronous code!\"\n        src=\"/static/5ce9b04179fd8283b2c1d5efe9c6ec6a/41099/expectation-closure.jpg\"\n        srcset=\"/static/5ce9b04179fd8283b2c1d5efe9c6ec6a/6c669/expectation-closure.jpg 285w,\n/static/5ce9b04179fd8283b2c1d5efe9c6ec6a/41099/expectation-closure.jpg 500w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Yes, you can test asynchronous code!</figcaption>\n  </figure></p>\n<p>How do they work? To test that asynchronous operations (and closure) behave as expected, you create one or more\nexpectations within your test, and then fulfill those expectations when the asynchronous operation completes\nsuccessfully. Your test method waits until all expectations are fulfilled or a specified timeout expires. The general\ncode structure for expectation with closure is like the following example:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> expectation <span class=\"token operator\">=</span> <span class=\"token class-name\">XCTestExpectation</span><span class=\"token punctuation\">(</span>description<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Expectation description\"</span></span><span class=\"token punctuation\">)</span>\n\nyourInstance<span class=\"token punctuation\">.</span><span class=\"token function\">method</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"aParam\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token class-name\">Your</span> assert using <span class=\"token class-name\">XCTAssert</span><span class=\"token operator\">...></span>\n    expectation<span class=\"token punctuation\">.</span><span class=\"token function\">fulfill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>expectation<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> timeout<span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>time to wait the fulfillment of the expecation<span class=\"token operator\">></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Basically to test asynchronous operation/closure you must:</p>\n<ul>\n<li>create an expectation that is an instance of <code class=\"language-text\">XCTestExpectation</code></li>\n<li>execute your closure, make your assert on the closure return value/parameter and call the method <code class=\"language-text\">fulfill</code>\nof <code class=\"language-text\">XCTestExpectation</code></li>\n</ul>\n<p>So, what about a more complex example? Let's see how powerful expectation are and most importantly how we can test them.\nSuppose for example we have a <a href=\"https://en.wikipedia.org/wiki/Use_case\" title=\"use case\">use case</a> class\ncalled <code class=\"language-text\">PasswordUpdateUseCase</code> with the following implementation:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PasswordUpdateUseCase</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> passwordService<span class=\"token punctuation\">:</span> <span class=\"token class-name\">PasswordService</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> passwordRepository<span class=\"token punctuation\">:</span> <span class=\"token class-name\">PasswordRepository</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>passwordService<span class=\"token punctuation\">:</span> <span class=\"token class-name\">PasswordService</span><span class=\"token punctuation\">,</span> passwordRepository<span class=\"token punctuation\">:</span> <span class=\"token class-name\">PasswordRepository</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>passwordService <span class=\"token operator\">=</span> passwordService\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>passwordRepository <span class=\"token operator\">=</span> passwordRepository\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">update</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        passwordService<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">:</span> password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> success<span class=\"token punctuation\">,</span> error <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">if</span> success <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>passwordRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">:</span> password<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see inside the <code class=\"language-text\">update</code> method we have an instance of <code class=\"language-text\">PasswordService</code> that, as the method name suggest,\nexecute an update of the user password and return the result of the operation inside a closure. How do we unit test?\nLet's see how we can achieve our objective using some handmade mock and expectation. For this post I will <strong>NOT USE</strong>\nthe  <a href=\"https://en.wikipedia.org/wiki/Given-When-Then\" title=\"Given-then-when\">\"Given-then-when\"</a> structure I used in\na <a href=\"/2017/08/11/model-view-presenter-architecture-ios-swift-unit-test/\">previous post</a>, because I want to keep the\nfocus on the code structure. First of all, to test our use case we need to mock the <code class=\"language-text\">PasswordRepository</code>. In our test we\nwant to verify if our <code class=\"language-text\">save</code> method has been called or not. We can achieve this objective by implementing a spy\nobject, <code class=\"language-text\">PasswordDatabaseRepositorySpy</code>, that exposes a status property <code class=\"language-text\">savePasswordHasBeenCalled</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">PasswordDatabaseRepositorySpy</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">PasswordRepository</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">var</span> savePasswordHasBeenCalled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">save</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        savePasswordHasBeenCalled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now it's time to mock our <code class=\"language-text\">PasswordService</code>. We need to mock it so that it has the following features:</p>\n<ul>\n<li>it exposes a status property that let us know if the method <code class=\"language-text\">update</code> has been called</li>\n<li>it simulates an asynchronous call inside the <code class=\"language-text\">update</code> method</li>\n<li>it can fulfill the expectation of our test in time</li>\n</ul>\n<p>A lot of stuff to do. Let's see how we can implement it. We will call it <code class=\"language-text\">PasswordNetworkServiceSpy</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">PasswordNetworkServiceSpy</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">PasswordService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">var</span> updatePasswordHasBeenCalled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> expectation<span class=\"token punctuation\">:</span> <span class=\"token class-name\">XCTestExpectation</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> successful<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span>\n\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>expectation<span class=\"token punctuation\">:</span> <span class=\"token class-name\">XCTestExpectation</span><span class=\"token punctuation\">,</span> successful<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>expectation <span class=\"token operator\">=</span> expectation\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>successful <span class=\"token operator\">=</span> successful\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">update</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token attribute atrule\">@escaping</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Bool</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">DispatchQueue</span><span class=\"token punctuation\">.</span>main<span class=\"token punctuation\">.</span><span class=\"token function\">asyncAfter</span><span class=\"token punctuation\">(</span>deadline<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">.</span><span class=\"token function\">milliseconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>updatePasswordHasBeenCalled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n            <span class=\"token function\">completion</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>successful<span class=\"token punctuation\">,</span> <span class=\"token class-name\">NSError</span><span class=\"token punctuation\">(</span>domain<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"error\"</span></span><span class=\"token punctuation\">,</span> code<span class=\"token punctuation\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> userInfo<span class=\"token punctuation\">:</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>expectation<span class=\"token punctuation\">.</span><span class=\"token function\">fulfill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The interesting thing of our implementation is that our spy will be in charge of fulfill the expectation, because the\nclosure executed inside the <code class=\"language-text\">PasswordUpdateUseCase</code> is created inside our <code class=\"language-text\">PasswordService</code> spy, and we have to be sure\nthat after its execution the <code class=\"language-text\">expectation.fulfill()</code> is called.<br>\nNow we are ready to write our unit tests. We will test two cases: update successful and update failure.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">AsynchronousTestingClosureDependencyTests</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">XCTestCase</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">testUseCaseUpdatePasswordSuccessful</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> updateExpectation <span class=\"token operator\">=</span> <span class=\"token function\">expectation</span><span class=\"token punctuation\">(</span>description<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"updateExpectation\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> service <span class=\"token operator\">=</span> <span class=\"token class-name\">PasswordNetworkServiceSpy</span><span class=\"token punctuation\">(</span>expectation<span class=\"token punctuation\">:</span> updateExpectation<span class=\"token punctuation\">,</span> successful<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> repository <span class=\"token operator\">=</span> <span class=\"token class-name\">PasswordDatabaseRepositorySpy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> passwordUseCase <span class=\"token operator\">=</span> <span class=\"token class-name\">PasswordUpdateUseCase</span><span class=\"token punctuation\">(</span>passwordService<span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span>\n                                                    passwordRepository<span class=\"token punctuation\">:</span> repository<span class=\"token punctuation\">)</span>\n        passwordUseCase<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"::password::\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>updateExpectation<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> timeout<span class=\"token punctuation\">:</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span>\n        <span class=\"token class-name\">XCTAssertTrue</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">.</span>updatePasswordHasBeenCalled<span class=\"token punctuation\">)</span>\n        <span class=\"token class-name\">XCTAssertTrue</span><span class=\"token punctuation\">(</span>repository<span class=\"token punctuation\">.</span>savePasswordHasBeenCalled<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">testUseCaseUpdatePasswordFail</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> updateExpectation <span class=\"token operator\">=</span> <span class=\"token function\">expectation</span><span class=\"token punctuation\">(</span>description<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"updateExpectation\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> service <span class=\"token operator\">=</span> <span class=\"token class-name\">PasswordNetworkServiceSpy</span><span class=\"token punctuation\">(</span>expectation<span class=\"token punctuation\">:</span> updateExpectation<span class=\"token punctuation\">,</span> successful<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> repository <span class=\"token operator\">=</span> <span class=\"token class-name\">PasswordDatabaseRepositorySpy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> passwordUseCase <span class=\"token operator\">=</span> <span class=\"token class-name\">PasswordUpdateUseCase</span><span class=\"token punctuation\">(</span>passwordService<span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span>\n                                                    passwordRepository<span class=\"token punctuation\">:</span> repository<span class=\"token punctuation\">)</span>\n        passwordUseCase<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"::password::\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>updateExpectation<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> timeout<span class=\"token punctuation\">:</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span>\n        <span class=\"token class-name\">XCTAssertTrue</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">.</span>updatePasswordHasBeenCalled<span class=\"token punctuation\">)</span>\n        <span class=\"token class-name\">XCTAssertFalse</span><span class=\"token punctuation\">(</span>repository<span class=\"token punctuation\">.</span>savePasswordHasBeenCalled<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see in this test we have an example of an expectation creation/usage. In each test we are calling\nthe <code class=\"language-text\">wait(for: [updateExpectation], timeout: 300)</code> so that the tests will \"wait\" until the expectation is fulfilled or\nthe max timeout is reach (and in the last case the test fails, no matter the other condition). The most strange thing is\nrelated to the order of instruction between the <code class=\"language-text\">wait</code> and the various <code class=\"language-text\">XCTAssert</code>. To make our tests work we need to\nwait until the closure inside the <code class=\"language-text\">update</code> method of the use case is completed. Then we can make our assertion and\nverify that our conditions are verified to make our test pass (so, in this case, we can verify that our various method\non the various collaborators have/have not been called). We are done with our example. As you can see you can experiment\na little bit with expectations and implement complex patterns to verify your closure. You can find the complete example\ndiscussed\nabove <a href=\"https://github.com/chicio/Asynchronous-Testing-Closure-Dependency\" title=\"asynchronous operation swift example\">here</a>.\nExpectation: your true friend for asynchronous code testing <img class=\"emoji-icon\" alt=\"emoji-heart\" data-icon=\"emoji-heart\" style=\"display: inline; margin: 0; position: relative; width: 20px\" src=\"data:image/png;base64, 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\" title=\"emoji-heart\">.</p>","frontmatter":{"title":"Asynchronous testing in Swift","comments":true,"authors":["fabrizio_duroni"],"tags":["swift","ios","apple","mobile application development","test driven development"],"date":"01 Jun 2018","description":"In this post I will talk about asynchronous testing in Swift.","math":false,"image":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","backgroundColor":"#080808","images":{"fallback":{"src":"/static/5ce9b04179fd8283b2c1d5efe9c6ec6a/be5ed/expectation-closure.jpg","srcSet":"/static/5ce9b04179fd8283b2c1d5efe9c6ec6a/be5ed/expectation-closure.jpg 500w","sizes":"100vw"},"sources":[{"srcSet":"/static/5ce9b04179fd8283b2c1d5efe9c6ec6a/5f169/expectation-closure.webp 500w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":1}}}},"fields":{"slug":"/2018/06/01/async-closure-test-mock-expectation-fulfill/","readingTime":{"text":"5 min read"}}},"site":{"siteMetadata":{"author":"Fabrizio Duroni"}}},"pageContext":{"slug":"/2018/06/01/async-closure-test-mock-expectation-fulfill/"}},"staticQueryHashes":["3076394108","379746230","4028829600","630498219"]}